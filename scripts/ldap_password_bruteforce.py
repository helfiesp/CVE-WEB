import os, ldap, time
from misc_scripts import secrets

ldap_server  = 'ldaps://ldaps.oslofelles.oslo.kommune.no:636'
username  = os.environ["CSIRT_LDAPUSER"]
password  = os.environ["CSIRT_LDAPPASSWORD"]
base_dn =  "DC=oslofelles,DC=oslo,DC=kommune,DC=no"

usernames = []
passwords = []

ldap.set_option(ldap.OPT_X_TLS_REQUIRE_CERT, ldap.OPT_X_TLS_NEVER)
ldap.set_option(ldap.OPT_PROTOCOL_VERSION, 3)
ldap_conn = ldap.initialize(ldap_server)
ldap_conn.set_option(ldap.OPT_REFERRALS, 0)

for user in usernames:
    for pwd in passwords:
        try:
            ldap_conn.bind_s("OSLOFELLES\\{}".format(user), pwd)
            print("User {} authenticated with password {}".format(user, pwd))
        except ldap.INVALID_CREDENTIALS:
            print("User {} authentication failed with password {}".format(user, pwd))
ldap_conn.unbind_s()