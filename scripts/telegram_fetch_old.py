import asyncio
from telethon import TelegramClient
from telethon.errors import SessionPasswordNeededError
import os


API_ID = os.environ["TELEGRAM_API_ID"]
API_HASH = os.environ["TELEGRAM_API_HASH"]
PHONE_NUMBER = os.environ["TELEGRAM_PHONE_NUMBER"]

async def fetch_messages(channel_link):
    client = TelegramClient('anon', API_ID, API_HASH)
    
    # Connect to the client
    await client.start(PHONE_NUMBER)
    
    # If your account has 2FA (Two-Factor Authentication) enabled, you'll need to enter the password
    if await client.is_user_authorized() == False:
        print("User is not authorized. Follow the instruction to authorize:")
        await client.send_code_request(PHONE_NUMBER)
        try:
            await client.sign_in(PHONE_NUMBER, input('Enter the code: '))
        except SessionPasswordNeededError:
            await client.sign_in(password=input('Password: '))
    
    # Fetch messages once authorized
    channel = await client.get_entity(channel_link)
    messages = await client.get_messages(channel, limit=None)
    
    for message in messages:
        print(message.date)  # print only the date

    await client.disconnect()

if __name__ == '__main__':
    channel_link = 'https://t.me/killnetl'
    asyncio.run(fetch_messages(channel_link))