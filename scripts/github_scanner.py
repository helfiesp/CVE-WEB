import datetime
import time
from github import Github
import base64
from misc_scripts import secrets
import os

def GetCurrentTime():
	now = datetime.datetime.now()
	current_time = now.strftime("%H:%M:%S")
	return current_time

g = Github(os.environ["GITHUB_API_SECRET_BASIC"])

# specify the organization/user and keyword to search for
org_name = "oslokommune"
keyword = "password"

# create a dictionary to store the search results
results = {}

# iterate over all repositories of the organization/user
for repo in g.get_user(org_name).get_repos():
    # iterate over all files in the repository
    for file in repo.get_contents(""):
        # check if the file has base64 encoding and contains the keyword
        if file.encoding == "base64" and keyword in file.decoded_content.decode('utf-8'):
            try:
                # decode the file content and split it into lines
                lines = file.decoded_content.decode('utf-8').splitlines()
                # iterate over all lines and find the line containing the keyword
                for i, line in enumerate(lines):
                    if keyword in line:
                        # add the search result to the dictionary
                        result = {"keyword": keyword, "repository": repo.name, "file": file.path, "line": i+1}
                        results[len(results) + 1] = result
            except Exception as e:
                print(f"Error decoding file {file.path}: {e}")

# print the search results
for i, result in results.items():
    print(f"Result {i}: {result}")