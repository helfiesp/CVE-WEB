import datetime
import time
from github import Github
import base64
from misc_scripts import secrets
import os

def GetCurrentTime():
	now = datetime.datetime.now()
	current_time = now.strftime("%H:%M:%S")
	return current_time


# Replace 'YOUR_ACCESS_TOKEN' with your personal access token
g = Github(os.environ["GITHUB_API_SECRET_BASIC"])

# Replace 'USER_OR_ORG_NAME' with the user or organization name you want to search
user = g.get_user('oslokommune')

# Replace 'KEYWORD' with the keyword you want to search for
keyword = 'KEYWORD'

results = {}

for repo in user.get_repos():
    for file in repo.get_contents(""):
        if file.type == "dir":
            continue
        if file.encoding == "base64" and keyword in file.decoded_content.decode('utf-8'):
            lines = file.decoded_content.decode('utf-8').splitlines()
            for i, line in enumerate(lines):
                if keyword in line:
                    result = {
                        "keyword": keyword,
                        "repo_name": repo.name,
                        "file_path": file.path,
                        "line_number": i + 1
                    }
                    results[len(results)] = result

print(results)