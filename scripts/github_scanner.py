import datetime
import time
from github import Github

def GetCurrentTime():
	now = datetime.datetime.now()
	current_time = now.strftime("%H:%M:%S")
	return current_time



# Create a Github object using an access token or username/password
g = Github()

# Specify the Github user whose repositories will be searched
user = g.get_user("oslokommune")

# Specify the keyword to search for
keyword = "#kjøremiljø-support request"

# Create an empty dictionary to store the search results
results = {}

# Loop through each repository owned by the user
for repo in user.get_repos():

    # Loop through each file in the repository
    for file in repo.get_files():
        
        # Check if the file contains the keyword
        if keyword in file.decoded_content.decode('utf-8'):
            
            # If the keyword is found, create a dictionary entry for the result
            result = {"keyword": keyword, "repository": repo.name, "file": file.path, "line": None}
            
            # Loop through each line in the file to find the line number where the keyword is located
            lines = file.decoded_content.decode('utf-8').splitlines()
            for i, line in enumerate(lines):
                if keyword in line:
                    result["line"] = i+1
                    break
            
            # Add the result to the dictionary of search results
            results[len(results)+1] = result

# Print the search results
print(results)
