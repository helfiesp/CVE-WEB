import datetime
import time
from github import Github

def GetCurrentTime():
	now = datetime.datetime.now()
	current_time = now.strftime("%H:%M:%S")
	return current_time


# Create a Github object without authentication
g = Github()

# Specify the Github organization whose repositories will be searched
org = g.get_organization("oslokommune")

# Specify the keyword to search for
keyword = "#kjøremiljø-support"

# Create an empty dictionary to store the search results
results = {}

# Loop through each repository owned by the organization
for repo in org.get_repos():

    # Check if the repository is public
    if not repo.private:
    
        # Loop through each file in the repository
        for file in repo.get_contents():
            
            # Check if the file contains the keyword
            if keyword in file.decoded_content.decode('utf-8'):
                
                # If the keyword is found, create a dictionary entry for the result
                result = {"keyword": keyword, "repository": repo.name, "file": file.path, "line": None}
                
                # Loop through each line in the file to find the line number where the keyword is located
                lines = file.decoded_content.decode('utf-8').splitlines()
                for i, line in enumerate(lines):
                    if keyword in line:
                        result["line"] = i+1
                        break
                
                # Add the result to the dictionary of search results
                results[len(results)+1] = result

# Print the search results
print(results)