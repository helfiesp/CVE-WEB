import os
import sqliteconnect as SQLC
from misc_scripts import secrets

filename = "/var/csirt/misc_files/vulnerabilities/qualys_vulns_20_02_2023.csv"
with open(filename) as f:
    lines = [line.rstrip('\n') for line in f]

full_str = ""
for line in lines[:40]:
	line = line.strip()
	if "ID;Severity;Status;Hostname;IP;Title;First detected;Last detected;Date Last Fixed;Public Facing;Results;CVE ID;OS" not in line:
		if len(line) > 5:
			if line[0].isnumeric() == True and line[3].isnumeric() == True:
				print(line)
				full_str += "---{}".format(line)
			else:
				full_str += line

list_of_vulns = full_str.split("---")

for x in list_of_vulns:
	x = x.split(";")
	if len(x) > 1:
		print(x[0])

def InsertQualysData(conn, data):
    sql = "INSERT INTO alerts_qualysresults(severity,status,hostname,ip,title,first_detected,last_detected,last_fixed,internet_exposed,filepath,cve,os,scan_time)VALUES(?,?)"
    values = (data, datetime.date.today())
    cur = conn.cursor()
    cur.execute(sql,values)
    conn.commit()
    conn.close()
