
import sqliteconnect as SQLC
from misc_scripts import secrets
import datetime
import pandas as pd

def main():
	filename = "/var/csirt/Vulnerabilities.xlsx"
	data = pd.read_excel(filename).to_dict('records')

	for entry in data:

		InsertQualysData(SQLC.SQLiteConnect(), entry)

def InsertQualysData(conn, data):
	sql = """INSERT INTO alerts_qualysresults(severity,status,hostname,ip,title,first_detected,last_detected,last_fixed,internet_exposed,filepath,cve,os,scan_time)
			 VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?)"""
	values = (data["Severity"], data["Status"], data["Hostname"], data["IP"], data["Title"], data["First detected"], data["Last detected"], data["Date Last Fixed"], data["Public Facing"],data["Results"],str(data["CVE ID"]),data["OS"],datetime.date.today())
	
	cur = conn.cursor()
	cur.execute(sql,values)
	conn.commit()
	conn.close()

if __name__ == '__main__':
	main()