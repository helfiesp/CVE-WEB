import os
import sqliteconnect as SQLC
from misc_scripts import secrets

filename = "/var/csirt/misc_files/vulnerabilities/qualys_vulns_20_02_2023.csv"
with open(filename) as f:
    lines = [line.rstrip('\n') for line in f]

full_str = ""
for line in lines:
	line = line.strip()
	if "ID;Severity;Status;Hostname;IP;Title;First detected;Last detected;Date Last Fixed;Public Facing;Results;CVE ID;OS" not in line:
		if len(line) > 5:
			if line[0].isnumeric() and line.count(";") > 5:
				full_str += "_-/*{}".format(line)
			else:
				full_str += line

list_of_vulns = full_str.split("_-/*")

lengths = []
for x in list_of_vulns:
	x = x.split(";")
	if len(x) > 1:
		print(x[0])
		if len(x[0]) > 6:
			lenghts.append(x[0])

print(lengths)

def InsertQualysData(conn, data):
    sql = "INSERT INTO alerts_qualysresults(severity,status,hostname,ip,title,first_detected,last_detected,last_fixed,internet_exposed,filepath,cve,os,scan_time)VALUES(?,?)"
    values = (data, datetime.date.today())
    cur = conn.cursor()
    cur.execute(sql,values)
    conn.commit()
    conn.close()
