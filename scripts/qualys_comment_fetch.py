import sqliteconnect as SQLC
from misc_scripts import secrets
from datetime import date, timedelta, datetime
import pandas as pd
import json
import sqlite3
import requests
import time
import os

def get_current_data(conn):
    # Initialize the cursor
    cur = conn.cursor()

    # Execute the query to fetch qualys_id, hostname, and comments
    cur.execute("SELECT qualys_id, hostname, comments FROM alerts_qualysresults")
    results = cur.fetchall()
    
    # Total number of records
    total_records = len(results)
    print(f"Total records to process: {total_records}")

    # Iterate through each result
    for i, result in enumerate(results, 1):
        qualys_id, hostname, comments = result

        # Create the qualys_identifier tuple
        qualys_identifier = (hostname, qualys_id)

        # Print the current iteration, hostname, and qualys_id
        print(f"Processing record {i}/{total_records}: Hostname - {hostname}, Qualys ID - {qualys_id}")

        # Insert the qualys_identifier and comments into QualysCommentsIdentifier table
        insert_query = """
        INSERT INTO QualysCommentsIdentifier (identifier, comments) 
        VALUES (?, ?)
        """
        cur.execute(insert_query, (str(qualys_identifier), comments))

    # Commit the transaction
    conn.commit()

    # Close the connection
    conn.close()
    print("All records have been processed.")



def main():
	get_current_data(SQLC.SQLiteConnect())


main()