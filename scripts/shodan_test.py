
import sqlite3
from datetime import datetime
import time
import scripts.shodan_filter as shodan_filter
import scripts.sqliteconnect as SQLC


def SQLiteShodanGetData(conn):
    cur = conn.cursor()
    cur.execute("SELECT * from alerts_shodanresults")
    result = cur.fetchall()
    conn.close()
    if result:
    	return result
    else:
        return False

def GetResults():
	results = SQLiteShodanGetData(SQLC.SQLiteConnect())
	results_list = []
	for x in results:
		entry = eval(x[1])
		entry["domains"] = str(entry["domains"]).replace("[","").replace("]","").replace("'","")
		entry["timestamp"] = entry["timestamp"].split("T")[0]
		if "product" not in entry:
			entry["product"] = "N/A"
		if entry not in results_list:
			resultset = {"entry_data":entry,"date_added":x[2], "comments":x[3], "id":x[0]}
			results_list.append(resultset.copy())
	return results_list

