import os
import scripts.sqliteconnect as SQLC

filename = "/var/csirt/misc_files/vulnerabilities/qualys_vulns_20_02_2023.csv"
with open(filename) as f:
    lines = [line.rstrip('\n') for line in f]

full_str = ""
for line in lines:
	line = line.strip()
	if "ID;Severity;Status;Hostname;IP;Title;First detected;Last detected;Date Last Fixed;Public Facing;Results;CVE ID;OS" not in line:
		if len(line) > 5:
			if line[0].isnumeric() == True:
				full_str += "---{}".format(line)
			else:
				full_str += line

list_of_vulns = full_str.split("---")

for x in list_of_vulns[:10]:
	x = x.split(";")
	if x:
		print(x)

def InsertQualysData(conn, data):
    sql = "INSERT INTO alerts_qualysresults(severity,status,hostname,ip,title,first_detected,last_detected,last_fixed,internet_exposed,filepath,cve,os,scan_time)VALUES(?,?)"
    values = (data, datetime.date.today())
    cur = conn.cursor()
    cur.execute(sql,values)
    conn.commit()
    conn.close()
