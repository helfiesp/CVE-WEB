import ldap, os
from misc_scripts import secrets

server = 'ldaps://ldaps.oslofelles.oslo.kommune.no:636'
user = "OSLOFELLES\\{}".format(os.environ["CSIRT_LDAPUSER"])
password = os.environ["CSIRT_LDAPPASSWORD"]

ldap.set_option(ldap.OPT_X_TLS_REQUIRE_CERT, ldap.OPT_X_TLS_NEVER)
ldap.set_option(ldap.OPT_PROTOCOL_VERSION, 3)
ldapClient = ldap.initialize(server)
ldapClient.set_option(ldap.OPT_REFERRALS, 0)
ldapClient.bind_s(user, password)

ldap_path = "DC=oslofelles,DC=oslo,DC=kommune,DC=no"
results = ldapClient.search_s(ldap_path, ldap.SCOPE_SUBTREE, '(objectClass=*)')
print(results)

