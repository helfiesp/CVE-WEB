import ldap, os
from misc_scripts import secrets

server = 'ldaps://ldaps.oslofelles.oslo.kommune.no:636'
user = os.environ["CSIRT_LDAPUSER"]
password = os.environ["CSIRT_LDAPPASSWORD"]

ldap.set_option(ldap.OPT_X_TLS_REQUIRE_CERT, ldap.OPT_X_TLS_NEVER)  # have to deactivate sertificate check
ldap.set_option(ldap.OPT_PROTOCOL_VERSION, 3)
ldapClient = ldap.initialize(server)
ldapClient.timeout = timeout
ldapClient.set_option(ldap.OPT_REFERRALS, 0)  # tells the server not to chase referrals
connect = ldapClient.bind_s(user, password)  # synchronious


username = "UKE373745"
ldap_path = "DC=oslofelles,DC=oslo,DC=kommune,DC=no"
ldap_filter = ('(&(objectClass=user)(cn=%s))' % username)
ldap_properties = ['cn', 'mail', 'givenName', 'displayName', 'sn', 'userAccountControl', 'logonCount', 'memberOf', 'lastLogonTimestamp', 'title', 'description', 'otherMobile', 'mobile', 'objectClass']
result = ldap_query(ldap_path=ldap_path, ldap_filter=ldap_filter, ldap_properties=ldap_properties, timeout=10)

print(result)