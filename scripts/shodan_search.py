from shodan import Shodan
import sqlite3
import datetime
import sqliteconnect as SQLC
from misc_scripts import secrets
import os

api = Shodan(os.environ["SHODAN_API_SECRET"])

def SQLiteShodanDataInsert(conn, data):
	sql = "INSERT INTO alerts_shodanresults(scan_data,entry_ip,entry_port,scan_time)VALUES(?,?,?,?)"
	values = (data,data["ip_str"], data["port"], datetime.date.today())
	cur = conn.cursor()
	cur.execute(sql,values)
	conn.commit()
	conn.close()
	print("DATA INSERTED: {}".format(data["ip_str"]))
	
def SQLiteShodanUpdate(conn, data):
	pass

def SQLiteShodanCheckEntry(conn, data):
    cur = conn.cursor()
    cur.execute("SELECT * from alerts_shodanresults where")
    result = cur.fetchall()
    conn.close()
    if result:
    	return result
    else:
        return False

def main():
	count = 0
	search = 'net:171.23.0.0/16'
	results = api.search(search)
	results2 = api.search(search, page=2)
	results3 = api.search(search, page=3)
	result_amount = results["total"]
	values = [results,results2,results3]
	for index in range(len(values)):
		print(type(index))
		for key in values[index]:
			print(type(key))
		
					


if __name__ == '__main__':
	main()