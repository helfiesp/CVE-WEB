{% extends "base.html" %}

{% block title %}Sårbarheter for domene: {{ vuln_data.Name }}{% endblock %}

{% block content %}
{% load custom_tags %}


<div class="CVE_Table_Header">
        <h1>Sårbarhetsinformasjon</h1>
        <p>
        <b>Plugin ID: </b><a href="https://www.tenable.com/plugins/nessus/{{ vuln_data.Plugin_ID }}" target="_blank">{{ vuln_data.Plugin_ID }}</a><br>
        <b>Name: </b> {{ vuln_data.Name }}<br>
        <b>CVE: </b> {{ vuln_data.CVE }}<br>
        <b>CVSS 2.0: </b> {{ vuln_data.CVSS }}<br>
        <b>Risk: </b> {{ vuln_data.Risk }}<br>
        <b>Synopsis: </b> {{ vuln_data.Synopsis }}<br>
        <b>Description </b><br>{{ vuln_data.Description }}<br><br>
        <b>Vulnerability comments</b>
        <form action="update_vulnerable_domain_comments" method="post">
        {% csrf_token %}
        <textarea style="width:600px;" rows="6" name="vuln_comment_{{vuln_data.Plugin_ID}}">{{ fetched_comment }}</textarea>
    </p>
</div>
<hr class="CVE_Table_HR">

{% if user|has_group:'CSIRT' %}
<div class="CVE_Table_Search">
    <button class="ButtonTableFilters" type="submit">Update comments</button><br>
    <br><hr class="CVE_Table_HR"><br>
   <input type="search" placeholder="Søk i kolonnen..." class="form-control search-input" data-table="exposed-servers" style="width: 200px;"/>
</div>

    <div class="CVE_table">
        <input type="hidden" name="plugin_id" value="{{ vuln_data.Plugin_ID }}">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Domain</th>
                        <th>Installed version</th>
                        <th>False positive</th>
                        <th>Comments</th>
 
                    </tr>
                </thead>
               <tbody>
                {% for vuln in Vulnerabilities %}
                <tr>
                 <td><a href="{% url 'attack_surface_search_by_domain' vuln.domain %}" class="toggle-click">
                        {{ vuln.domain }}
                    </a></td>
                    <td>{{ vuln.Plugin_Output }}</td>
                    <td class="center-content">
                        <label class="checkbox_container_false_positive">
                            <input type="checkbox" name="false_positive_checkbox-{{ vuln_data.Plugin_ID }}-{{ vuln.domain }}" value="1" {% if vuln.false_positive|is_false_positive:vuln_data.Plugin_ID %} checked="checked" {% endif %}>
                            <span class="checkmark_false_positive"></span>
                        </label>
                    </td>
                    <td>
                        <textarea rows="2" name="comment_{{vuln.domain}}">{{vuln.plugin_comments|comment_for_plugin:vuln_data.Plugin_ID}}</textarea>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </form>
            </table>
        </div>
    </div>

{% endif %}
{% endblock %}