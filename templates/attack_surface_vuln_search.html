{% extends "base.html" %}

{% block title %}Sårbarheter for domene: {{ vuln_data.Name }}{% endblock %}

{% block content %}
{% load custom_tags %}

<div class="CVE_Table_Header">
        <h1>Sårbarhetsinformasjon</h1>
        <p>
        <b>Plugin ID: </b><a href="https://www.tenable.com/plugins/nessus/{{ vuln_data.Plugin_ID }}" target="_blank">{{ vuln_data.Plugin_ID }}</a><br>
        <b>Navn: </b> {{ vuln_data.Name }}<br>
        <b>CVE: </b> {{ vuln_data.CVE }}<br>
        <b>CVSS 2.0: </b> {{ vuln_data.CVSS }}<br>
        <b>Risko: </b> {{ vuln_data.Risk }}<br>
        <b>Synopsis: </b> {{ vuln_data.Synopsis }}<br>
        <b>Beskrivelse </b><br>{{ vuln_data.Description }}
    </p>
</div>

{% if user|has_group:'CSIRT' %}
<div class="CVE_Table_Search">
    <input type="search" placeholder="Søk i kolonnen..." class="form-control search-input" data-table="exposed-servers"/>
    <button onclick="ExportToExcel('xlsx')">Eksporter data</button>
    <form action="update_vulnerable_domain_comments" method="post">
    {% csrf_token %}
    <button class="ButtonTableFilters" type="submit">Update comments</button> 

</div>

    <div class="CVE_table">
        <input type="hidden" name="plugin_id" value="{{ vuln_data.Plugin_ID }}">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Domain</th>
                        <th>Server</th>
                        <th>Comments</th>
 
                    </tr>
                </thead>
               <tbody>
                {% for vuln in Vulnerabilities %}
                <tr>
                 <td><a href="{% url 'attack_surface_search_by_domain' vuln.domain %}" class="toggle-click">
                        {{ vuln.domain }}
                    </a></td>
                    <td>{{ vuln.server }}</td>
                    <td><textarea rows="2" name="comment_{{vuln.domain}}">{{vuln.comments}}</textarea></td>
                </tr>
                {% endfor %}
            </tbody>
        </form>
            </table>
        </div>
    </div>

{% endif %}
{% endblock %}