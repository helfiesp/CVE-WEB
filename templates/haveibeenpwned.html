{% extends "base.html" %}
{% block title %}HaveIBeenPwned{% endblock %}
{% block content %}
{% load custom_tags %}

<div class="CVE_table">
    <h2>HaveIBeenPwned</h2>
    <!-- Add a button for filtering by 'Passwords' data class -->
    <button id="filter-passwords">Show Only 'Passwords' Data Class</button>
    <!-- Add an input for filtering by year -->
    <input type="number" id="filter-year" placeholder="Enter Year" min="1900" max="2099">
    <button id="apply-year-filter">Apply Year Filter</button>

    <table class="sortable" id="data-table">
        <thead>
            <th>Email</th>
            <th>Breached Sites</th>
            <th>Breached Details</th>
        </thead>
        <tbody id="data-rows">
            {% for Entry in breachedaccounts %}
            <tr>
                <td>{{ Entry.email_address }}</td>
                <td>{{ Entry.breached_sites }}</td>
                <td>
                    {% for breach in Entry.breached_data %}
                        <span class="breach-date"><b>{{ breach.breached_site }}</b>: {{ breach.breach_date }}</span><br>
                        <span class="data-classes">
                            {% for data_class in breach.data_classes %}
                                {{ data_class }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </span>
                        <br>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.getElementById('filter-passwords').addEventListener('click', function() {
        var rows = document.querySelectorAll('#data-rows tr');
        rows.forEach(function(row) {
            var hasPasswords = row.querySelector('.data-classes').innerText.includes('Passwords');
            row.style.display = hasPasswords ? '' : 'none'; // Toggle display based on 'Passwords'
        });
    });

    document.getElementById('apply-year-filter').addEventListener('click', function() {
        var filterYear = document.getElementById('filter-year').value;
        var rows = document.querySelectorAll('#data-rows tr');
        rows.forEach(function(row) {
            var dateText = row.querySelector('.breach-date').innerText;
            var rowYear = dateText.split('-')[0].split(': ')[1]; // Extract the year part of 'Site: YYYY-MM-DD'
            row.style.display = rowYear === filterYear ? '' : 'none'; // Toggle display based on year
        });
    });
</script>
{% endblock %}