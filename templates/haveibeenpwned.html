{% extends "base.html" %}
{% block title %}HaveIBeenPwned{% endblock %}
{% block content %}
{% load custom_tags %}

<div class="CVE_table">
<h2>HaveIBeenPwned</h2>
<div class="TableFilters">
    <form action="{% url 'hibp_breached_accounts_search' %}" method="post">
        {% csrf_token %}


        <label class="checkbox_container">Lekkede passord
            <input type="checkbox" name="passwords_checkbox" value="1"{% if filters.passwords %} checked="checked"{% endif %}>
            <span class="checkmark"></span>
        </label>
        <hr class="CVE_Table_HR">

        <p style="font-size: 18px;">Filtrer på årstall <input style="width:50px;" type="number" name="year_filter" placeholder="Enter Year" min="1900" max="{{ current_year }}" value="{% if filters.year %}{{ filters.year }}{% endif %}"><br>

        Filtrer på virksomhet <select name="domain_filter">
            <option value="">Velg domene</option>
            {% for domain in unique_domains %}
                <option value="{{ domain }}" {% if filters.domain == domain %} selected {% endif %}>{{ domain|capitalize }}</option>
            {% endfor %}
        </select><br>
        <input type="search" style="width:300px;" name="entry_search" placeholder="Søk med e-post"></p>
        <hr class="CVE_Table_HR">
        <button class="ButtonTableFilters" type="submit">Søk</button>
        <hr class="CVE_Table_HR">
    </form>
</div>

    <table class="sortable" id="data-table">
        <thead>
            <th>Email</th>
            <th>Breached Sites</th>
            <th>Breached Details</th>
        </thead>
        <tbody id="data-rows">
            {% for Entry in breachedaccounts %}
            <tr>
                <td>{{ Entry.email_address }}</td>
                <td>{{ Entry.breached_sites|linkify|safe }}</td>
                <td>
                    {% for breach in Entry.breached_data %}
                        <span class="breach-date"><b><a href="https://haveibeenpwned.com/PwnedWebsites#{{ breach.breached_site }}" target="_blank">{{ breach.breached_site }}</a></b>: {{ breach.breach_date }}</span><br>
                        <span class="data-classes">
                            {% for data_class in breach.data_classes %}
                                {{ data_class }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </span>
                        <br>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}