{% load static %}
<html>
<header>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<!----<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">!-->
<title>CSIRT</title>
<link rel="stylesheet" href="/static/css/main_css.css">
<link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}"/>
<script>
    (function(document) {
        'use strict';

        var TableFilter = (function(myArray) {
            var search_input;

            function _onInputSearch(e) {
                search_input = e.target;
                var tables = document.getElementsByClassName(search_input.getAttribute('data-table'));
                myArray.forEach.call(tables, function(table) {
                    myArray.forEach.call(table.tBodies, function(tbody) {
                        myArray.forEach.call(tbody.rows, function(row) {
                            var text_content = row.textContent.toLowerCase();
                            var search_val = search_input.value.toLowerCase();
                            row.style.display = text_content.indexOf(search_val) > -1 ? '' : 'none';
                        });
                    });
                });
            }

            return {
                init: function() {
                    var inputs = document.getElementsByClassName('search-input');
                    myArray.forEach.call(inputs, function(input) {
                        input.oninput = _onInputSearch;
                    });
                }
            };
        })(Array.prototype);

        document.addEventListener('readystatechange', function() {
            if (document.readyState === 'complete') {
                TableFilter.init();
            }
        });

    })(document);
</script>
</header>

<body>
<div class="Top_Nav">
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">CVE</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'cve_yesterday' %}'">Siste døgn</a>
          <a onclick="location.href='{% url 'cve_weekly' %}'">Siste 7 dager</a>
          <a onclick="location.href='{% url 'cve_monthly' %}'">Denne måneden</a>
          <a onclick="location.href='{% url 'google_news_scraper' %}'">Nye CVEer</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">Attack surface</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'shodan' %}'">Shodan</a>
        </div>
    </div>
    <button class="Top_Nav_Button" onclick="location.href='{% url 'qualys' %}'">Qualys</button>
    <form action="send_alert" method="post">
    {% csrf_token %}
    <button class="Top_Nav_Button" type="submit">Send varsling</button>
</div>

<div class="CVE_table">
    <p>{{ message|safe }}</p>
    {% if DailyNews %}
    <h2>Varslinger fra andre kilder</h2>
    <p>Denne seksjonen inneholder varslinger fra nyhetskilder som f.eks andre CERTer.</p>
    <div class="News_Alerts">
        <table class="sortable">
            <thead>
                <th>Kilde</th>
                <th>Dato</th>
                <th>Tittel</th>
                <th>Beskrivelse</th>
            </thead>
            {% for article in DailyNews %}
                <tr>
                    <td>{{article.article_source|safe}}</td>
                    <td>{{article.article_date}}</td>
                    <td>{{article.article_title|safe}}</td>
                    <td>{{article.article_description}}</td>
                </tr>
            {% endfor %}
        </table>   
    </div>
    {% endif %}

    {% if UnlistedCVEs %}
    <div class="CVE_table">
    <h2>Nye CVEer</h2>
    <p>Dette søket kjøres regelmessig, henter resultater fra de siste 2 dagene.<br>
    Søket søker etter CVEer på Google, og sjekker om CVEen ligger i den NVD.<br>
    Hvis den ikke ligger i NVD, er det trolig en ny CVE, som f.eks kan være satt av leverandør i en security advisory.<br>
    Søket scanner igjennom de første 3 sidene med Google resultater.</p>

    <table class="sortable">
        <thead>
            <th>CVE</th>
            <th>Time</th>
            <th>URL</th>
            <th>Header</th>
            <th>Description</th>
        </thead>
        {% for Entry in UnlistedCVEs %}


        <tr>
            <td>{{Entry.cve_id}}</td>
            <td>{{Entry.article_time_since}}</td>
            <td><a href="{{Entry.article_url}}">{{Entry.article_website}}</td>
            <td>{{Entry.article_header}}</td>
            <td>{{Entry.article_description}}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <h2>CVE oversikt</h2>
    <p>Oversikt over CVEer hentet fra nvd.nist.gov</p>
    <div class="CVE_Statistics">
        <hr>
        <b>Spørring:</b> {{ CVEQuery }}<br>
        <b>Antall CVEer:</b> {{ CVE_Count }}<br>
        </p>
    </div>
    <input type="search" placeholder="Søk..." class="form-control search-input" data-table="cve-list"/>
    <table class="table table-striped mt32 cve-list sortable">
        <thead>
            <tr>
                <th>CVE</th>
                <th>Dato</th>
                <th>Kilde</th>
                <th>CVSS</th>
                <th>OK påvirket</th>
                <th>Tweets</th>
                <th>Beskrivelse</th>
                <th>Send varsling</th>
            </tr>
        </thead>
        {% for value in CVE_list  %}

        <tr>
            <td style="width: 50px;"><a href="{{value.cve_url}}" target="_blank">{{value.cve_id}}</a></td>
            <td style="width: 50px;">{{value.date}}</td>
            <td>{{value.source}}</td>
            {% if value.cvss_score != "N/A" %}
                {% if value.cvss_score >= 9 %}
                    <td class="CVSS_Score_Numeric_DarkRed">{{value.cvss_score}}</td>
                {% elif value.cvss_score >= 7.5 and value.cvss_score < 9 %}
                    <td class="CVSS_Score_Numeric_red">{{value.cvss_score}}</td>
                {% elif value.cvss_score >= 5 and value.cvss_score < 7.5 %}
                    <td class="CVSS_Score_Numeric_yellow">{{value.cvss_score}}</td>
                {% else %}
                    <td class="CVSS_Score_Numeric_Green">{{value.cvss_score}}</td>
                {% endif %}
            {% else %}
                <td class="CVSS_Score_NA">{{value.cvss_score}}</td>
            {% endif %}
            <td>{{value.potentially_impacted}}</td>
            <td class="CVSS_Score_NA"><a href="https://twitter.com/search?q={{value.cve_id}}&src=typed_query" target="_blank">{{value.recent_tweets}}</td>
            
            <td>{{value.description}}</td>
            <td><input class="Alert_Checkbox" type="checkbox" name="send_alert" value="{{value.cve_id}}"></td>
        </tr>
        {% endfor %}
    </form>
    </table>
</div>

</html>
