{% extends "base.html" %}
{% block title %}Send alert{% endblock %}
{% block content %}
{% load custom_tags %}

<div class="CVE_table">
<p class="ErrorMsg">{{ message|safe }}</p>
<h1 style="margin-top:50px">Send varsling</h1>
{% if AlertMessage %}
    <h2> {{ AlertMessage }} </h2>
{% endif %}
<p>I tabellen nedenfor ligger de valgte CVEene som skal varsles.<br>
Velg mottaker (e-post) og eventuelle andre på kopi, separert med komma.<br>
</p>
    <div class="Send_Alert_Menu">
        <form action="send_alert_email" method="post" id="send_alert_form" name="send_alert_form">
        {% csrf_token %}
        <label>Mottaker: <input class="alert_textbox" type="text" name="alert_receiver" size=30></label><br>
        <label>Kopi: <input class="alert_textbox" type="text" name="alert_cc" size=30></label><br>
        <input class="alert_textbox" type="hidden" name="cve_table" value="{{ Selected_CVEs }}">
        <textarea name="alert_text" form="send_alert_form" rows=5 cols=50></textarea><br><br>
        <button class="ButtonTableFilters" type="submit">Send varsling</button><br>
    </div>

<table class="sortable">
    <thead>
        <th>CVE</th>
        <th>Dato</th>
        <th>Kilde</th>
        <th>CVSS</th>
        <th>OK påvirket</th>
        <th>Beskrivelse</th>
        <th>Send varsling</th>
    </thead>
    {% for CVE in Selected_CVEs  %}

    <tr>
        <td style="width: 50px;"><a href="{{CVE.cve_url}}">{{CVE.cve_id}}</a></td>
        <td style="width: 50px;">{{CVE.date}}</td>
        <td>{{CVE.source}}</td>
        {% if CVE.cvss_score != "N/A" %}
            {% if CVE.cvss_score >= 9 %}
                <td class="CVSS_Score_Numeric_DarkRed">{{CVE.cvss_score}}</td>
            {% elif CVE.cvss_score >= 7.5 and CVE.cvss_score < 9 %}
                <td class="CVSS_Score_Numeric_red">{{CVE.cvss_score}}</td>
            {% elif CVE.cvss_score >= 5 and CVE.cvss_score < 7.5 %}
                <td class="CVSS_Score_Numeric_yellow">{{CVE.cvss_score}}</td>
            {% else %}
                <td class="CVSS_Score_Numeric_Green">{{CVE.cvss_score}}</td>
            {% endif %}
        {% else %}
            <td class="CVSS_Score_NA">{{CVE.cvss_score}}</td>
        {% endif %}
        <td>{{CVE.potentially_impacted}}</td>
        <td>{{CVE.description}}</td>
        <td><input class="Alert_Checkbox" type="checkbox" name="CVEs" value="{{CVE}}" checked></td>
    </tr>
    {% endfor %}
</form>
</table>
</div>

{% endblock %}
