{% extends "base.html" %}

{% block title %}Attack surface{% endblock %}

{% block content %}
{% load custom_tags %}

<div class="CVE_Table_Header">
    <h1>Eksponerte porter</h1>
    <p>Her ligger oversikten over alle eksponerte porter og tjenestene som kjører på dem.</p>
</div>

<div class="TableFilters">
    <form action="{% url 'attack_surface_search_by_type' %}" method="post">
        {% csrf_token %}
        <hr class="CVE_Table_HR">
        <p><b>Søkefunksjon</b><br>
        Bruk menyen til høyre for å velge søkefilter.</p>

        <input type="search" style="width:300px;" name="vuln_search" {% if filters and filters.vuln_search %} value="{{ filters.vuln_search }}" {% endif %}>
        <select name="search_type">
            <option value="domain" {% if filters and filters.search_type == 'domain' %} selected {% endif %}>Domain</option>
            <option value="cve" {% if filters and filters.search_type == 'cve' %} selected {% endif %}>CVE</option>
            <option value="description" {% if filters and filters.search_type == 'description' %} selected {% endif %}>Description</option>
            <option value="name" {% if filters and filters.search_type == 'name' %} selected {% endif %}>Name</option>
            <option value="synopsis" {% if filters and filters.search_type == 'synopsis' %} selected {% endif %}>Synopsis</option>
        </select>
        <br><br>
        <button class="ButtonTableFilters" type="submit">Søk</button>
    </form>
</div>


{% if user|has_group:'CSIRT' %}

{% if PortData %}
<div class="CVE_table">
    <div class="table-responsive">
        <table class="table table-striped sortable">
            <thead>
              <tr>
                <th>Domain</th>
                <th>Port</th>
                <th>Protocol</th>
                <th>Status</th>
                <th>Service</th>
              </tr>
            </thead>
            <tbody>
              {% for domain, ports in PortData.items %}
                {% for port in ports %}
                  <tr>
                    <td>{{ domain }}</td>
                    <td>{{ port.port }}</td>
                    <td>{{ port.protocol }}</td>
                    <td>{{ port.status }}</td>
                    <td>{{ port.service }}</td>
                  </tr>
                {% endfor %}
              {% endfor %}
            </tbody>
  </table>
</div>
</div>
{% else %}
  <p>No port data available.</p>
{% endif %}
   

{% endif %}
{% endblock %}