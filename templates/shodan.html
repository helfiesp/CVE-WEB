{% load static %}
<html>
<header>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<title>Shodan</title>
<link rel="stylesheet" href="{% static 'css/main_css.css' %}">
<script>
    (function(document) {
        'use strict';

        var TableFilter = (function(myArray) {
            var search_input;

            function _onInputSearch(e) {
                search_input = e.target;
                var tables = document.getElementsByClassName(search_input.getAttribute('data-table'));
                myArray.forEach.call(tables, function(table) {
                    myArray.forEach.call(table.tBodies, function(tbody) {
                        myArray.forEach.call(tbody.rows, function(row) {
                            var text_content = row.textContent.toLowerCase();
                            var search_val = search_input.value.toLowerCase();
                            row.style.display = text_content.indexOf(search_val) > -1 ? '' : 'none';
                        });
                    });
                });
            }

            return {
                init: function() {
                    var inputs = document.getElementsByClassName('search-input');
                    myArray.forEach.call(inputs, function(input) {
                        input.oninput = _onInputSearch;
                    });
                }
            };
        })(Array.prototype);

        document.addEventListener('readystatechange', function() {
            if (document.readyState === 'complete') {
                TableFilter.init();
            }
        });

    })(document);
</script>
</header>

<body>
<div class="Top_Nav">
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">CVE</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'index' %}'">Siste døgn</a>
          <a onclick="location.href='{% url 'weekly_cve' %}'">Siste 7 dager</a>
          <a onclick="location.href='{% url 'monthly_cve' %}'">Denne måneden</a>
          <a onclick="location.href='{% url 'google_news_scraper' %}'">Nye CVEer</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">Attack surface</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'shodan' %}'">Shodan</a>
        </div>
    </div>
    <button class="Top_Nav_Button" onclick="location.href='{% url 'SOC' %}'">SOC</button>
</div>
<div class="CVE_table">
<h2>Shodan API</h2>
<h3>Info om søket</h3>

<input type="search" placeholder="Søk..." class="form-control search-input" data-table="exposed"/>
    <table class="table table-striped mt32 cve-list sortable">
    <thead>
        <th>Product</th>
        <th>IP</th>
        <th>Port</th>
        <th>HTTP Code</th>
        <th>Date scanned</th>
        <th>Domains</th>
        <th>CVEs</th>
    </thead>

    {% for Entry in ShodanResults %}

        <tr>
            <td>{{Entry.product}} {{Entry.version}}</td>
            {% if Entry.http.status == 200 %}
                {% if Entry.port == 80 %}
                    <td><a href="http://{{Entry.ip_str}}">{{Entry.ip_str}}</a></td>
                {% else %}
                    <td><a href="https://{{Entry.ip_str}}">{{Entry.ip_str}}</a></td>
                {% endif %}
            {% else %}
                <td>{{Entry.ip_str}}</td>
            {% endif %}

            <td>{{Entry.port}}</td>
            {% if Entry.http.status == 200 %}
                <td style="color:green">{{Entry.http.status}}</td>
            {% elif Entry.http.status == 404 %}
                <td style="color:red">{{Entry.http.status}}</td>
            {% elif Entry.http.status == 301 %}
                <td style="color:blue">{{Entry.http.status}}</td>
            {% else %}
                <td>{{Entry.http.status}}</td>
            {% endif %}

            <td>{{Entry.timestamp}}</td>
            <td>{{Entry.domains}}</td>

            <td>
            {% for key,value in Entry.vulns.items %}
                {% if value.cvss >= 9 %}
                    <div class="CVSS_Critical">
                        <a style="text-decoration: none;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% elif value.cvss >= 7 %}
                    <div class="CVSS_High">
                        <a style="text-decoration: none; text-decoration-color: #f74d40;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% endif %}

            {% endfor %}
            </td>

            
        </tr>
    {% endfor %}
</table>

</div>
</div>
</html>

