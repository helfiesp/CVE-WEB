{% load static %}
<html>
<header>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<title>Shodan</title>
<link rel="stylesheet" href="{% static 'css/main_css.css' %}">
</header>

<body>
<div class="Top_Nav">
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">CVE</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'index' %}'">Siste døgn</a>
          <a onclick="location.href='{% url 'weekly_cve' %}'">Siste 7 dager</a>
          <a onclick="location.href='{% url 'monthly_cve' %}'">Denne måneden</a>
          <a onclick="location.href='{% url 'google_news_scraper' %}'">Nye CVEer</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="Top_Nav_Button" onclick="location.href='{% url 'index' %}'">Attack surface</button>
        <div class="dropdown-content">
          <a onclick="location.href='{% url 'shodan' %}'">Shodan</a>
        </div>
    </div>
    <button class="Top_Nav_Button" onclick="location.href='{% url 'SOC' %}'">SOC</button>
</div>
<div class="CVE_table">
<h2>Shodan API</h2>
<h3>Info om søket</h3>
<p>
{% for Entry,value in ShodanStats.items %}
   <b>{{ Entry }}</b>: {{ value }}<br>
{% endfor %}

<h3>Endringer siden siste søk</h3>
<p>
{% for IP in NewIPs %}
   <b>Ny IP:</b> {{ IP }}<br>
{% endfor %}
{% for IP in RemovedIPs %}
   <b>Fjernet IP:</b> {{ IP }}<br>
{% endfor %}
</p>
<table class="sortable">
    <thead>
        <th>Product</th>
        <th>IP</th>
        <th>Port</th>
        <th>HTTP Code</th>
        <th>Date scanned</th>
        <th>Domains</th>
        <th>CVEs</th>
    </thead>

    {% for Entry in ShodanResults %}

        <tr>
            <td>{{Entry.product}} {{Entry.version}}</td>
            {% if Entry.ip_str in NewIPs %}
                <td><b>NEW</b>: {{Entry.ip_str}}</td>
            {% elif Entry.ip_str in RemovedIPs %}
                <td><b>REMOVED</b>: {{Entry.ip_str}}</td>
            {% else %}
                <td>{{Entry.ip_str}}</td>
             {% endif %}
            <td>{{Entry.port}}</td>
            <td>{{Entry.http.status}}</td>
            <td>{{Entry.timestamp}}</td>
            <td>{{Entry.domains}}</td>
            <td>
            {% for key,value in Entry.vulns.items %}
                {% if value.cvss >= 9 %}
                    <div class="CVSS_Critical">
                        <a style="text-decoration: none;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% elif value.cvss >= 7 %}
                    <div class="CVSS_High">
                        <a style="text-decoration: none; text-decoration-color: #f74d40;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% elif value.cvss >= 5 %}
                    <div class="CVSS_Medium">
                        <a style="text-decoration: none;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% else %}
                    <div class="CVSS_Low">
                        <a style="text-decoration: none;" href="https://nvd.nist.gov/vuln/detail/{{ key }}">{{ key }} CVSS: <b>{{ value.cvss }}</b></a>
                    </div>
                {% endif %}

                 , 
            {% endfor %}
            </td>

            
        </tr>
    {% endfor %}
</table>

</div>
</div>
</html>

